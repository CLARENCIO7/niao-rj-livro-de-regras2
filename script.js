const modal=document.getElementById("searchModal");const openBtn=document.getElementById("openSearch");const closeBtn=document.getElementById("closeSearch");const input=document.getElementById("searchInput");const resultsBox=document.getElementById("searchResults");const links=[...document.querySelectorAll(".nav-link")];const sections=[...document.querySelectorAll(".section")];function openModal(){modal.style.display="flex";modal.setAttribute("aria-hidden","false");input.value="";resultsBox.innerHTML="";input.focus()}function closeModal(){modal.style.display="none";modal.setAttribute("aria-hidden","true")}openBtn.addEventListener("click",openModal);closeBtn.addEventListener("click",closeModal);document.addEventListener("keydown",e=>{if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==="k"){e.preventDefault();openModal()}if(e.key==="Escape")closeModal()});function normalize(s){return s.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"")}function getText(el){return normalize(el.textContent||"")}function indexSections(){return sections.map(s=>{const title=s.querySelector("h2")?.textContent||"";const text=getText(s);return{el:s,id:s.id,title,raw:s.textContent||"",text}})}function setActiveSection(id){sections.forEach(s=>{s.classList.toggle("active",s.id===id)});links.forEach(l=>{const linkId=l.getAttribute("href").slice(1);l.classList.toggle("active",linkId===id)});location.hash="#"+id}const index=indexSections();function renderResults(items){resultsBox.innerHTML="";if(!items.length){const empty=document.createElement("div");empty.className="result";empty.textContent="Nenhum resultado";resultsBox.appendChild(empty);return}items.slice(0,50).forEach(it=>{const r=document.createElement("div");r.className="result";const t=document.createElement("div");t.className="result-title";t.textContent=it.title;const s=document.createElement("div");s.className="result-snippet";const q=input.value.trim();if(q.length){const pos=it.raw.toLowerCase().indexOf(q.toLowerCase());const start=Math.max(0,pos-40);const end=Math.min(it.raw.length,pos+120);s.textContent=it.raw.slice(start,end)+"..."}else{s.textContent=it.raw.slice(0,160)+"..."}r.appendChild(t);r.appendChild(s);r.addEventListener("click",()=>{setActiveSection(it.id);closeModal()});resultsBox.appendChild(r)})}input.addEventListener("input",()=>{const q=normalize(input.value.trim());if(!q){renderResults(index);return}const items=index.filter(it=>it.text.includes(q)||normalize(it.title).includes(q));renderResults(items)});renderResults(index);links.forEach(l=>{l.addEventListener("click",e=>{const id=l.getAttribute("href").slice(1);if(id){e.preventDefault();setActiveSection(id)}})});const initial=location.hash?location.hash.slice(1):sections[0]?.id;setActiveSection(initial||"nota");
